version: '3.8'

# Production-specific docker-compose configuration
# Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  # ============================================
  # RAG API Service (Production)
  # ============================================
  rag-api:
    build:
      target: production
    restart: always
    environment:
      - DEBUG=false
      - LOG_LEVEL=INFO
    command: >
      uvicorn src.sgk_rag.api.main:app
      --host 0.0.0.0
      --port 8000
      --workers 4
      --log-level info
      --no-access-log
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G

  # ============================================
  # Qdrant with production settings
  # ============================================
  qdrant:
    restart: always
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G

  # ============================================
  # Nginx Reverse Proxy (Production)
  # ============================================
  nginx:
    image: nginx:alpine
    container_name: rag-nginx
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
    depends_on:
      - rag-api
    networks:
      - rag-network
